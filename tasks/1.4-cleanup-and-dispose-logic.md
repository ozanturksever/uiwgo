---
id: 1.4
title: "Cleanup and Dispose Logic"
status: "todo"
part: 1
area: "Core Reactivity API"
---

### Step 1.4: Cleanup and Dispose Logic

*   **Goal:** Implement manual memory management for effects.
*   **Actions:**
    1.  Add a `disposed` flag to the `effect` struct.
    2.  Implement `Effect.Dispose()`, which sets the `disposed` flag.
    3.  Modify the effect execution logic to not run if it's disposed.
    4.  Implement `OnCleanup(fn func())`. It should add the cleanup function to a list within the current effect context.
    5.  When an effect is about to re-execute or is disposed, run all of its registered cleanup functions.
*   **Testing (`TestCleanupAndDispose`):**
    *   Verify `Dispose()` prevents an effect from re-running.
    *   Verify `OnCleanup` functions are called when an effect re-runs.
    *   Verify `OnCleanup` functions are called when an effect is disposed.